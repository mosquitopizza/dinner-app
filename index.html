<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2025 Family Beach Trip</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase SDKs (Compat version for easier use in single file) -->
    <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-firestore-compat.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- CORRECTED FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyC4ivOi7TL5F3Tp23y1XmmZJuRVcMdosw0",
            authDomain: "beach-dinner-signup.firebaseapp.com",
            projectId: "beach-dinner-signup",
            storageBucket: "beach-dinner-signup.appspot.com",
            messagingSenderId: "47314255862",
            appId: "1:47314255862:web:1954797f2680e77fcd91d7"
        };

        // --- Google Font & CSS for background pattern ---
        const GlobalStyles = () => (
            <style>{`
                @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
                body {
                    font-family: 'Poppins', sans-serif;
                    background-color: #fef3c7; /* amber-100 */
                    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 80 40' width='80' height='40'%3E%3Cpath fill='%237dd3fc' fill-opacity='0.2' d='M0 40c20 0 20-40 40-40s20 40 40 40v-40H0v40z'%3E%3C/path%3E%3C/svg%3E");
                }
                .font-poppins {
                    font-family: 'Poppins', sans-serif;
                }
                .animate-fade-in {
                    animation: fadeIn 0.5s ease-in-out;
                }
                @keyframes fadeIn {
                    from { opacity: 0; transform: translateY(-10px); }
                    to { opacity: 1; transform: translateY(0); }
                }
            `}</style>
        );
        
        // --- Icon Components ---
        const Sun = (props) => (
            <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12"x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
        );
        const PlusCircle = (props) => (
            <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10" /><line x1="12" x2="12" y1="8" y2="16" /><line x1="8" x2="16" y1="12" y2="12" />
            </svg>
        );
        const Pencil = (props) => (
            <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
            </svg>
        );
        const CalendarDays = (props) => (
            <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect width="18" height="18" x="3" y="4" rx="2" ry="2" /><line x1="16" x2="16" y1="2" y2="6" /><line x1="8" x2="8" y1="2" y2="6" /><line x1="3" x2="21" y1="10" y2="10" />
            </svg>
        );
        const LogoutIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
        );


        // --- Main App Component ---
        const App = () => {
            const { useState, useEffect } = React;

            const [schedule, setSchedule] = useState([]);
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [db, setDb] = useState(null);
            const [auth, setAuth] = useState(null);
            const [isAdmin, setIsAdmin] = useState(false);
            const [view, setView] = useState('main'); // 'main' or 'admin'
            const [dates, setDates] = useState(null);
            const appId = 'family-beach-trip';

            useEffect(() => {
                try {
                    if (typeof firebase === 'undefined') {
                        setError("Firebase SDKs failed to load.");
                        setLoading(false);
                        return;
                    }
                    if (!firebaseConfig.apiKey || firebaseConfig.apiKey === "YOUR_API_KEY") {
                        setError("Firebase is not configured. Please add your API keys.");
                        setLoading(false);
                        return;
                    }
                    const app = firebase.initializeApp(firebaseConfig);
                    setDb(app.firestore());
                    setAuth(app.auth());
                } catch (err) {
                    setError("Failed to initialize Firebase.");
                    setLoading(false);
                }
            }, []);

            useEffect(() => {
                if (!auth) return;
                const unsubscribe = auth.onAuthStateChanged(user => {
                    if (user) {
                        setUser(user);
                        setIsAdmin(user.email === 'stevewstrawn@gmail.com');
                    } else {
                        // If no user, sign in anonymously
                        auth.signInAnonymously().catch(err => {
                            setError("Could not sign in anonymously.");
                        });
                    }
                });
                return () => unsubscribe();
            }, [auth]);

            useEffect(() => {
                if (!db) return;
                const configRef = db.collection('config').doc('dates');
                const unsubscribe = configRef.onSnapshot(doc => {
                    if (doc.exists) {
                        const data = doc.data();
                        const generatedDates = generateDates(data.start, data.end);
                        setDates({ ...data, generated: generatedDates });
                    } else {
                         // If no dates are set, stop loading and show a message
                        setLoading(false);
                    }
                }, err => {
                    setError("Could not load trip dates.");
                    setLoading(false);
                });
                return () => unsubscribe();
            }, [db]);

            useEffect(() => {
                if (!db || !user || !dates) {
                    if(user && !dates) setLoading(false); // Stop loading if user is ready but dates are not
                    return;
                };
                const scheduleCollectionRef = db.collection('schedules').doc(dates.year.toString()).collection('days');
                const unsubscribe = scheduleCollectionRef.onSnapshot((snapshot) => {
                    const signupData = {};
                    snapshot.forEach(doc => {
                        signupData[doc.id] = doc.data();
                    });
                    const updatedSchedule = dates.generated.map(day => ({ ...day, ...signupData[day.id] }));
                    setSchedule(updatedSchedule);
                    setLoading(false);
                }, (err) => {
                    setError("Failed to load schedule.");
                    setLoading(false);
                });
                return () => unsubscribe();
            }, [db, user, dates]);

            const handleAdminLogin = () => {
                const provider = new firebase.auth.GoogleAuthProvider();
                auth.signInWithPopup(provider).catch(err => setError("Failed to sign in with Google."));
            };

            const handleSignOut = () => {
                auth.signOut();
                setView('main');
            };

            const handleSignup = async (dayId, name, entree, sides) => {
                if (!name.trim() || !entree.trim() || !db) return;
                try {
                    const dayRef = db.collection('schedules').doc(dates.year.toString()).collection('days').doc(dayId);
                    await dayRef.set({
                        personName: name,
                        entree: entree,
                        sides: sides,
                        isTaken: true,
                    });
                } catch (err) {
                    setError("Could not save signup.");
                }
            };
            
            const generateDates = (startDateStr, endDateStr) => {
                const dates = [];
                let currentDate = new Date(`${startDateStr}T00:00:00`);
                const endDate = new Date(`${endDateStr}T00:00:00`);

                while (currentDate <= endDate) {
                    const dateString = currentDate.toISOString().split('T')[0];
                    dates.push({
                        id: dateString,
                        date: currentDate.toLocaleDateString('en-US', { month: 'long', day: 'numeric' }),
                        day: currentDate.toLocaleDateString('en-US', { weekday: 'long' }),
                    });
                    currentDate.setDate(currentDate.getDate() + 1);
                }
                return dates;
            };

            if (error) {
                return <div className="h-screen flex items-center justify-center bg-red-50 p-4"><GlobalStyles /><div className="text-center bg-white p-8 rounded-lg shadow-lg"><h2 className="text-2xl font-bold text-red-700">An Error Occurred</h2><p className="text-red-600 mt-2">{error}</p></div></div>;
            }

            if (loading) {
                return (
                    <div className="flex justify-center items-center h-screen bg-amber-100">
                        <GlobalStyles />
                        <div className="text-center">
                            <CalendarDays className="h-12 w-12 text-sky-500 mx-auto animate-spin" />
                            <p className="text-xl text-stone-600 mt-4 font-poppins">Loading Dinner Schedule...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen font-poppins p-4 sm:p-6 lg:p-8">
                    <GlobalStyles />
                    <div className="max-w-4xl mx-auto">
                        <header className="text-center mb-10">
                            <div className="absolute top-4 right-4 flex items-center gap-4">
                               {user && user.isAnonymous && <button onClick={handleAdminLogin} className="bg-gray-600 text-white font-bold py-2 px-4 rounded-lg">Admin Login</button>}
                               {isAdmin && <button onClick={() => setView(view === 'admin' ? 'main' : 'admin')} className="bg-indigo-500 text-white font-bold py-2 px-4 rounded-lg">{view === 'admin' ? 'View Schedule' : 'Admin'}</button>}
                               {isAdmin && <button onClick={handleSignOut} className="bg-gray-200 p-2 rounded-full hover:bg-gray-300"><LogoutIcon /></button>}
                            </div>
                            <div className="inline-block bg-white/60 p-2 rounded-full shadow-lg transform hover:scale-110 transition-transform duration-300 mt-4">
                                <div className="bg-orange-400 p-4 rounded-full">
                                   <Sun className="h-12 w-12 text-white"/>
                                </div>
                            </div>
                            <h1 className="text-5xl sm:text-6xl font-bold text-cyan-900 mt-4">{dates ? `${dates.year} Family Beach Trip!` : 'Family Beach Trip!'}</h1>
                            {view === 'main' && dates && <p className="text-lg text-cyan-800 mt-2">Dinner Schedule: {dates.generated[0].date} - {dates.generated[dates.generated.length - 1].date}</p>}
                            {view === 'main' && <p className="text-xl text-orange-600 font-semibold mt-4">Pick a night to be the chef!</p>}
                        </header>

                        {view === 'admin' ? (
                            <AdminView db={db} currentDates={dates} />
                        ) : !dates ? (
                            <div className="text-center text-xl text-gray-600">The trip dates have not been set yet. The admin needs to set them.</div>
                        ) : (
                            <div className="space-y-5">
                                {schedule.map(day => <DayCard key={day.id} day={day} onSignup={handleSignup} />)}
                            </div>
                        )}
                        
                        <footer className="text-center mt-10 text-cyan-800/70 text-sm">
                            <p>Have fun in the sun! ☀️🦀🌊</p>
                        </footer>
                    </div>
                </div>
            );
        };
        
        const AdminView = ({ db, currentDates }) => {
            const { useState, useEffect } = React;
            const [year, setYear] = useState('');
            const [startDate, setStartDate] = useState('');
            const [endDate, setEndDate] = useState('');
            const [message, setMessage] = useState('');

            useEffect(() => {
                if (currentDates) {
                    setYear(currentDates.year);
                    setStartDate(currentDates.start);
                    setEndDate(currentDates.end);
                }
            }, [currentDates]);

            const handleSaveDates = async (e) => {
                e.preventDefault();
                if (!year || !startDate || !endDate) {
                    setMessage('Please fill out all fields.');
                    return;
                }
                try {
                    const configRef = db.collection('config').doc('dates');
                    await configRef.set({
                        year: parseInt(year),
                        start: startDate,
                        end: endDate,
                    });
                    setMessage('Dates saved successfully!');
                    setTimeout(() => setMessage(''), 3000);
                } catch (err) {
                    setMessage('Failed to save dates.');
                }
            };
            
            return (
                <div className="bg-white/80 p-6 rounded-xl shadow-lg">
                    <h2 className="text-3xl font-bold text-cyan-900 mb-4">Admin Panel - Set Vacation Dates</h2>
                    <form onSubmit={handleSaveDates} className="space-y-4">
                        <div>
                            <label htmlFor="year" className="block text-sm font-semibold text-cyan-800 mb-1">Trip Year</label>
                            <input type="number" id="year" value={year} onChange={e => setYear(e.target.value)} className="w-full p-2 border rounded-lg" placeholder="e.g., 2025" />
                        </div>
                        <div>
                            <label htmlFor="start-date" className="block text-sm font-semibold text-cyan-800 mb-1">Start Date</label>
                            <input type="date" id="start-date" value={startDate} onChange={e => setStartDate(e.target.value)} className="w-full p-2 border rounded-lg" />
                        </div>
                        <div>
                            <label htmlFor="end-date" className="block text-sm font-semibold text-cyan-800 mb-1">End Date</label>
                            <input type="date" id="end-date" value={endDate} onChange={e => setEndDate(e.target.value)} className="w-full p-2 border rounded-lg" />
                        </div>
                        <button type="submit" className="bg-sky-500 text-white font-bold py-2 px-4 rounded-lg">Save Dates</button>
                        {message && <p className="mt-4 text-green-600">{message}</p>}
                    </form>
                </div>
            );
        };

        // --- Day Card Component ---
        const DayCard = ({ day, onSignup }) => {
            const { useState } = React;
            const [isEditing, setIsEditing] = useState(false);
            const [name, setName] = useState('');
            const [entree, setEntree] = useState('');
            const [sides, setSides] = useState('');

            const isTaken = day.isTaken;

            const handleEditClick = () => {
                setName(day.personName || '');
                setEntree(day.entree || '');
                setSides(day.sides || '');
                setIsEditing(true);
            };
            
            const handleCancel = () => {
                setIsEditing(false);
                setName('');
                setEntree('');
                setSides('');
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                onSignup(day.id, name, entree, sides);
                setIsEditing(false);
            };

            return (
                <div className={`bg-white/80 backdrop-blur-sm rounded-xl shadow-lg overflow-hidden transition-all duration-500 hover:shadow-2xl hover:-translate-y-1 ${isTaken ? 'border-l-8 border-sky-400' : 'border-l-8 border-orange-400'}`}>
                    <div className="p-6">
                        <div className="flex justify-between items-center mb-4">
                            <div>
                                <p className="text-sm font-semibold text-sky-600 uppercase tracking-wider">{day.day}</p>
                                <h2 className="text-3xl font-bold text-cyan-900">{day.date}</h2>
                            </div>
                            {!isTaken && !isEditing && <button onClick={handleEditClick} className="flex items-center gap-2 bg-orange-400 text-white font-bold py-2 px-5 rounded-full hover:bg-orange-500 transition-all duration-300 shadow-md hover:shadow-lg transform hover:scale-105"><PlusCircle className="h-5 w-5"/>I'll Cook!</button>}
                            {isTaken && !isEditing && <button onClick={handleEditClick} className="flex items-center gap-2 bg-rose-400 text-white font-bold py-2 px-5 rounded-full hover:bg-rose-500 transition-all duration-300 shadow-md hover:shadow-lg transform hover:scale-105"><Pencil className="h-5 w-5"/>Edit</button>}
                        </div>
                        {isEditing ? (
                            <form onSubmit={handleSubmit} className="border-t border-amber-200 pt-4 animate-fade-in">
                                <div className="space-y-4">
                                    <div>
                                        <label htmlFor={`name-${day.id}`} className="block text-sm font-semibold text-cyan-800 mb-1">Chef's Name</label>
                                        <input type="text" id={`name-${day.id}`} value={name} onChange={e => setName(e.target.value)} className="mt-1 block w-full px-4 py-2 bg-white/70 border border-amber-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500" placeholder="e.g., Sandy Cheeks" required />
                                    </div>
                                    <div>
                                        <label htmlFor={`entree-${day.id}`} className="block text-sm font-semibold text-cyan-800 mb-1">Main Dish</label>
                                        <input type="text" id={`entree-${day.id}`} value={entree} onChange={e => setEntree(e.target.value)} className="mt-1 block w-full px-4 py-2 bg-white/70 border border-amber-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500" placeholder="e.g., Freshly Grilled Fish" required />
                                    </div>
                                    <div>
                                        <label htmlFor={`sides-${day.id}`} className="block text-sm font-semibold text-cyan-800 mb-1">Sides (optional)</label>
                                        <input type="text" id={`sides-${day.id}`} value={sides} onChange={e => setSides(e.target.value)} className="mt-1 block w-full px-4 py-2 bg-white/70 border border-amber-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500" placeholder="e.g., Pineapple Salad" />
                                    </div>
                                </div>
                                <div className="mt-6 flex justify-end space-x-3">
                                    <button type="button" onClick={handleCancel} className="font-semibold text-stone-600 py-2 px-4 rounded-lg hover:bg-amber-100/70 transition-colors">Cancel</button>
                                    <button type="submit" className="bg-sky-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-sky-600 transition-colors shadow-sm">Save Changes</button>
                                </div>
                            </form>
                        ) : isTaken ? (
                            <div className="border-t border-amber-200 pt-4">
                                <div className="flex items-center gap-3">
                                    <Sun className="h-6 w-6 text-orange-500"/>
                                    <p className="text-lg font-bold text-cyan-900">{day.personName} is cooking:</p>
                                </div>
                                <div className="mt-3 pl-9 text-cyan-800">
                                   <p><span className="font-semibold">Main:</span> {day.entree}</p>
                                   {day.sides && <p className="mt-1"><span className="font-semibold">Sides:</span> {day.sides}</p>}
                                </div>
                            </div>
                        ) : <div className="text-center text-orange-500/80 pt-4 border-t border-dashed border-amber-300">This night is up for grabs!</div>}
                    </div>
                </div>
            );
        };
        
        // --- Mount the React App ---
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
