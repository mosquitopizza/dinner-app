<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2025 Family Beach Trip</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase SDKs (Compat version for easier use in single file) -->
    <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-firestore-compat.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- CORRECTED FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyC4ivOi7TL5F3Tp23y1XmmZJuRVcMdosw0",
            authDomain: "beach-dinner-signup.firebaseapp.com",
            projectId: "beach-dinner-signup",
            storageBucket: "beach-dinner-signup.appspot.com",
            messagingSenderId: "47314255862",
            appId: "1:47314255862:web:1954797f2680e77fcd91d7"
        };
        
        // --- Icon Components ---
        const Sun = (props) => (
            <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12"x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
        );
        const PlusCircle = (props) => (
            <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10" /><line x1="12" x2="12" y1="8" y2="16" /><line x1="8" x2="16" y1="12" y2="12" />
            </svg>
        );
        const Trash2 = (props) => (
            <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M3 6h18" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /><line x1="10" x2="10" y1="11" y2="17" /><line x1="14" x2="14" y1="11" y2="17" />
            </svg>
        );

        // --- Main App Component ---
        const App = () => {
            const { useState, useEffect } = React;

            const [schedule, setSchedule] = useState([]);
            const [userId, setUserId] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [db, setDb] = useState(null);
            const [auth, setAuth] = useState(null);
            const appId = 'family-beach-trip-2025';

            useEffect(() => {
                try {
                    if (typeof firebase === 'undefined') {
                        setError("Firebase SDKs failed to load. Please check your internet connection and refresh.");
                        setLoading(false);
                        return;
                    }
                    if (!firebaseConfig.apiKey || firebaseConfig.apiKey === "YOUR_API_KEY") {
                        setError("Firebase is not configured. Please add your API keys.");
                        setLoading(false);
                        return;
                    }
                    const app = firebase.initializeApp(firebaseConfig);
                    setDb(app.firestore());
                    setAuth(app.auth());
                } catch (err) {
                    console.error("Firebase Init Error:", err);
                    setError("Failed to initialize Firebase. Check that your API keys are correct.");
                    setLoading(false);
                }
            }, []);

            useEffect(() => {
                if (!auth) return;
                const unsubscribe = auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        setUserId(user.uid);
                    } else {
                        try {
                            await auth.signInAnonymously();
                        } catch (err) {
                            setError("Could not connect to the authentication service.");
                            setLoading(false);
                        }
                    }
                });
                return () => unsubscribe();
            }, [auth]);

            useEffect(() => {
                if (!db || !userId) return;
                const scheduleCollectionRef = db.collection('schedules').doc(appId).collection('days');
                const initialDates = [
                    { id: '2025-08-02', date: 'August 2', day: 'Saturday' },
                    { id: '2025-08-03', date: 'August 3', day: 'Sunday' },
                    { id: '2025-08-04', date: 'August 4', day: 'Monday' },
                    { id: '2025-08-05', date: 'August 5', day: 'Tuesday' },
                    { id: '2025-08-06', date: 'August 6', day: 'Wednesday' },
                    { id: '2025-08-07', date: 'August 7', day: 'Thursday' },
                    { id: '2025-08-08', date: 'August 8', day: 'Friday' },
                    { id: '2025-08-09', date: 'August 9', day: 'Saturday' },
                ];
                const unsubscribe = scheduleCollectionRef.onSnapshot((snapshot) => {
                    const signupData = {};
                    snapshot.forEach(doc => {
                        signupData[doc.id] = doc.data();
                    });
                    const updatedSchedule = initialDates.map(day => ({ ...day, ...signupData[day.id] }));
                    setSchedule(updatedSchedule);
                    setLoading(false);
                }, (err) => {
                    console.error("Firestore Error:", err);
                    setError("Failed to load schedule. Check your Firestore security rules.");
                    setLoading(false);
                });
                return () => unsubscribe();
            }, [db, userId]);

            const handleSignup = async (dayId, name, entree, sides) => {
                if (!name.trim() || !entree.trim() || !db) return;
                try {
                    const dayRef = db.collection('schedules').doc(appId).collection('days').doc(dayId);
                    await dayRef.set({
                        personName: name,
                        entree: entree,
                        sides: sides,
                        isTaken: true,
                        signupUserId: userId
                    });
                } catch (err) {
                    setError("Could not save signup.");
                }
            };

            const handleRemove = async (dayId) => {
                if (!db) return;
                try {
                    const dayRef = db.collection('schedules').doc(appId).collection('days').doc(dayId);
                    await dayRef.delete();
                } catch (err) {
                    setError("Could not remove signup.");
                }
            };

            if (error) {
                return <div className="h-screen flex items-center justify-center bg-red-50 p-4"><div className="text-center bg-white p-8 rounded-lg shadow-lg"><h2 className="text-2xl font-bold text-red-700">An Error Occurred</h2><p className="text-red-600 mt-2">{error}</p></div></div>;
            }
            if (loading) {
                return <div className="h-screen flex items-center justify-center"><p className="text-xl">Loading Dinner Schedule...</p></div>;
            }

            return (
                <div className="bg-amber-50 min-h-screen font-sans p-4 sm:p-6 lg:p-8" style={{ fontFamily: "'Poppins', sans-serif" }}>
                    <div className="max-w-4xl mx-auto">
                        <header className="text-center mb-10">
                            <h1 className="text-5xl font-bold text-cyan-900 mt-4">2025 Family Beach Trip!</h1>
                            <p className="text-xl text-orange-600 font-semibold mt-4">Pick a night to be the chef!</p>
                        </header>
                        <div className="space-y-5">
                            {schedule.map(day => <DayCard key={day.id} day={day} currentUserId={userId} onSignup={handleSignup} onRemove={handleRemove} />)}
                        </div>
                    </div>
                </div>
            );
        };

        // --- Day Card Component ---
        const DayCard = ({ day, currentUserId, onSignup, onRemove }) => {
            const { useState } = React;
            const [isSigningUp, setIsSigningUp] = useState(false);
            const [name, setName] = useState('');
            const [entree, setEntree] = useState('');
            const [sides, setSides] = useState('');

            const isTaken = day.isTaken;
            const isOwner = isTaken && day.signupUserId === currentUserId;

            const handleSubmit = (e) => {
                e.preventDefault();
                onSignup(day.id, name, entree, sides);
                setIsSigningUp(false);
            };

            return (
                <div className={`bg-white/80 backdrop-blur-sm rounded-xl shadow-lg overflow-hidden transition-all duration-300 ${isTaken ? 'border-l-8 border-sky-400' : 'border-l-8 border-orange-400'}`}>
                    <div className="p-6">
                        <div className="flex justify-between items-center mb-4">
                            <div>
                                <p className="text-sm font-semibold text-sky-600 uppercase">{day.day}</p>
                                <h2 className="text-3xl font-bold text-cyan-900">{day.date}</h2>
                            </div>
                            {!isTaken && !isSigningUp && <button onClick={() => setIsSigningUp(true)} className="flex items-center gap-2 bg-orange-400 text-white font-bold py-2 px-5 rounded-full hover:bg-orange-500">I'll Cook!</button>}
                            {isOwner && <button onClick={() => onRemove(day.id)} className="flex items-center gap-2 bg-rose-400 text-white font-bold py-2 px-5 rounded-full hover:bg-rose-500">Cancel</button>}
                        </div>
                        {isSigningUp ? (
                            <form onSubmit={handleSubmit} className="border-t pt-4">
                                <div className="space-y-4">
                                    <input type="text" value={name} onChange={e => setName(e.target.value)} className="w-full p-2 border rounded" placeholder="Your Name" required />
                                    <input type="text" value={entree} onChange={e => setEntree(e.target.value)} className="w-full p-2 border rounded" placeholder="Main Dish" required />
                                    <input type="text" value={sides} onChange={e => setSides(e.target.value)} className="w-full p-2 border rounded" placeholder="Sides (optional)" />
                                </div>
                                <div className="mt-4 flex justify-end gap-3">
                                    <button type="button" onClick={() => setIsSigningUp(false)} className="font-semibold">Nevermind</button>
                                    <button type="submit" className="bg-sky-500 text-white font-bold py-2 px-4 rounded-lg">Save My Spot</button>
                                </div>
                            </form>
                        ) : isTaken ? (
                            <div className="border-t pt-4">
                                <p className="text-lg font-bold text-cyan-900">{day.personName} is cooking:</p>
                                <div className="pl-4">
                                   <p><span className="font-semibold">Main:</span> {day.entree}</p>
                                   {day.sides && <p><span className="font-semibold">Sides:</span> {day.sides}</p>}
                                </div>
                            </div>
                        ) : <div className="text-center text-orange-500/80 pt-4 border-t border-dashed">This night is up for grabs!</div>}
                    </div>
                </div>
            );
        };
        
        // --- Mount the React App ---
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
